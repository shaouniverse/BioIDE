<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<!--
    Title:消息编辑页
    Description：消息编辑页
    Author：WangTianshan (王天山)
    Created date: 2017/9/15 21:35
    Copyright: The Research Group of Biodiversity Informatics (BiodInfo Group) - 中国科学院动物研究所生物多样性信息学研究组
    Version: Html5
 -->
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title>BioIDE&nbsp;物种数据采集系统</title>
    <link rel="shortcut icon" th:href="@{/images/logo-black.png}" href="/images/logo.png" type="images/x-icon"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="description" content=""/>
    <!-- 引入css -->
    <!-- Select2 4.0.3 -->
    <link rel="stylesheet" th:href="@{/plugins/select2/css/select2.min.css}" type="text/css"/>    
    <span th:substituteby="pageFrame/basicsCss :: copy" />
</head>
<body class="hold-transition skin-dark fixed sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper" align="left">
   <header id="header" class="main-header">
       <!--  引入Header -->
        <span th:replace="pageFrame/basicsHeader :: copy" />
    </header>
    <!-- 引入 Left side column. contains the sidebar -->
    <span th:replace="pageFrame/basicsMenu :: copy" />
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                团队邀请
                <small>在这里您可以向用户发出团队邀请</small>
            </h1>
            <ol class="breadcrumb">
                <li><a th:href="@{/}" href="/"><i class="fa fa-home"></i> 首页</a></li>
                <li class="active"><i class="fa fa-envelope"></i> 消息管理</li>
            </ol>
        </section>
        <!-- Main content -->
        <section class="content">
            <div class="row">
                <div class="col-md-9">
                    <div class="box box-primary">
                        <div class="box-body">
                            <form id="thisForm" th:action="@{/console/message/send}" method="post" th:object="${thisMessage}">
                                <input id="errorMsg" th:value="${errorMsg}" class="hidden" readonly="readonly"></input>
                                <input class="hidden" id="TeamID" name="TeamID" th:value="${thisMessage.teamid}" value="${thisMessage.teamid}">
                                <input class="hidden" id="base_url" name="base_url" readonly="readonly"></input>
                                <!-- 可输可选下拉框 -->
                                <div class="form-group">
									<label>Email：</label>
					                <select class="form-control select2" id="udata" name="udata" style="width: 100%;" placeholder="Email:">
					                	<option value='' selected='selected'></option>
					                </select>
								</div>
                                
                                <div class="form-group">
                                    <input class="form-control" id="title" th:field="*{title}" placeholder="主题:" value="${thisMessage.title}">
                                </div>
                                <div class="form-group">
	                                <textarea id="editor"  th:field="*{text}" class="form-control" style="height: 300px" value="${thisMessage.text}">
									</textarea>
	                            <div class="box-footer">
                                <div class="pull-right">
                                    <button type="submit" class="btn btn-primary"><i class="fa fa-envelope-o"></i> 发送</button>
                                </div>
                                <a onclick="clearInput1();" type="reset" class="btn btn-default"><i class="fa fa-times"></i> 清除</a>
                            </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- content-wrapper -->
    <footer class="main-footer">
        <span th:replace="pageFrame/basicsFooter :: copy" />
    </footer>
    <!-- Control Sidebar -->
    <span th:replace="pageFrame/basicsControl :: copy" />
    <!-- Add the sidebar's background. This div must be placed immediately after the control sidebar -->
    <div class="control-sidebar-bg"></div>
</div>

<!-- 引入js【body末尾引入js文件会使页面加载更快】 -->
<span th:replace="pageFrame/basicsJs :: copy" ></span>
<!-- page_script -->
<script th:src="@{/js/superTableScript.js}"></script>
<script th:src="@{/plugins/CKEditor5/classic/ckeditor.js}"></script>
<!--<script th:src="@{/plugins/CKEditor4/ckeditor.js}"></script>
<!-- bootstrapValidator -->
<script th:src="@{/plugins/bootstrapValidator/js/bootstrapValidator.min.js}"></script>SS

<script>
    ClassicEditor
        .create(document.querySelector( '#editor' ))
        .catch(error => {
        console.error(error);
    } );
</script>

<script th:inline="javascript">
    var all_udata= [[#{all_udata}]];
</script>

<script type="text/javascript">
  //初始化插件语言变量
  var datetimepickerLanguage="en";
  var select2Language="en";
  </script>
  <!-- Select2 4.0.3 -->
  <script th:src="@{/plugins/select2/js/select2.full.min.js}"></script>
    <th:block th:if="${#locale.getLanguage().equals('zh')}">
        <script th:src="@{/plugins/select2/js/i18n/zh-CN.js}"></script>
        <script type="text/javascript">
            //语言变更
            select2Language="zh-CN";
        </script>
    </th:block>
<script>
$(".select2").select2({
});
//拼接option
function formatRepo (repo) {
    if (repo.loading){
    	return repo.text;
    }
    var markup = repo.full_name;
    return markup;
}
//拼接option
function formatRepoSelection (repo) {
    return repo.full_name;
}
//构造select2的方法
function buildSelect2 (select_id,url) {
	$("#"+select_id).select2({
        language : select2Language,
        ajax: {
            url: url,
            dataType: 'json',
            delay: 250,
            data: function (params) {
                return {
                    find: params.term,
                    page: params.page
                };
            },
            processResults: function (data, params) {
                params.page = params.page || 1;
                return {
                    results: data.items,
                    pagination: {
                        more: (params.page * 30) < data.total_count
                    }
                };
            },
            cache: true
        },
        escapeMarkup: function (markup) {
        	return markup; 
        	},
        minimumInputLength: 0,
        templateResult: formatRepo,
        templateSelection: formatRepoSelection
    });
}
//初始化所有select组件
$(document).ready(function(){
    //构造select2
    buildSelect2 ("udata","user/data");
    $("#udata").val();
    $("#udata").prepend("<option value='' selected='selected'>"+ all_udata +"</option>");
});
</script>

<script>
    //清空表单
     function clearInput1() {
     	$('#thisForm')[0].reset();
        $("#udata").empty();
        CKEDITOR.instances.editor.setData(' ');
        CKEDITOR.replace('#editor');
        $("#editor").val("");
        $('#thisForm').data('bootstrapValidator')
            .updateStatus('title', 'NOT_VALIDATED',null)
            .updateStatus('text', 'NOT_VALIDATED',null)
            .validateField('title')
            .validateField('text');
    }; 
    //后端验证错误提示
    $(document).ready(function () {
        if($('#errorMsg').val()==""||$('#errorMsg').val()==null){
        }
        else{
            layer.msg($('#errorMsg').val(), function(){
            });
        }
    });
</script>

<!-- page_script -->
<script th:inline="javascript">
    /*<![CDATA[*/
    var warning_Illegal= [[#{warning_Illegal}]];
    /*]]>*/
</script>

<script>
    //前端验证错误提示
    $(document).ready(function() {
	    $("#base_url").val(window.location.host);
        $('#thisForm').bootstrapValidator({
            message: 'This value is not valid',
            feedbackIcons: {
                valid: 'glyphicon ',
                invalid: 'glyphicon ',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                'title': {
                    validators: {
                        notEmpty: {
                        },
                        regexp: {
                            regexp: /^[\da-zA-Z_\u4e00-\u9f5a【】]+$/,
                            message: warning_Illegal
                        },
                        stringLength: {
                            min: 2,
                            max: 30,
                        },
                    }
                },
                'text': {
                    validators: {
                        stringLength: {
                            min: 0,
                            max: 100
                        },
                        regexp: {
                            regexp: /^[\da-zA-Z_\u4e00-\u9f5a，。,.【】]+$/,
                            message: warning_Illegal
                        },
                    }
                },
            }
        });
    });
</script>
</body>
</html>